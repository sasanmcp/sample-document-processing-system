{
  "total_statements": 2,
  "extraction_date": "2025-01-25",
  "statements": [
    {
      "statement_id": "view_1",
      "file_path": "src/DocumentProcessor.Infrastructure/InfrastructureServiceCollectionExtensions.cs",
      "line_number": 143,
      "statement_type": "CREATE VIEW",
      "view_name": "vw_DocumentSummary",
      "original_sql": "CREATE VIEW vw_DocumentSummary AS\nSELECT\n    documenttypename,\n    status,\n    COUNT(*) AS DocumentCount,\n    AVG(DATEDIFF(SECOND, uploadedat, COALESCE(processedat, GETUTCDATE()))) AS AvgProcessingTimeSeconds,\n    MIN(uploadedat) AS FirstUploadedAt,\n    MAX(uploadedat) AS LastUploadedAt\nFROM dps_dbo.documents\nWHERE isdeleted = 0\nGROUP BY documenttypename, status",
      "sql_server_specific_syntax": [
        "DATEDIFF(SECOND, ...)",
        "GETUTCDATE()",
        "COALESCE()"
      ],
      "referenced_tables": [
        "dps_dbo.documents"
      ],
      "context": "Database view creation in EnsureDatabaseAsync method"
    },
    {
      "statement_id": "procedure_1",
      "file_path": "src/DocumentProcessor.Infrastructure/InfrastructureServiceCollectionExtensions.cs",
      "line_number": 160,
      "statement_type": "CREATE PROCEDURE",
      "procedure_name": "sp_GetRecentDocuments",
      "original_sql": "CREATE PROCEDURE sp_GetRecentDocuments\n    @Days INT = 7,\n    @Status INT = NULL,\n    @DocumentTypeName NVARCHAR(200) = NULL\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT\n        id,\n        filename,\n        fileextension,\n        storagepath,\n        filesize,\n        documenttypename,\n        documenttypecategory,\n        status,\n        processingstatus,\n        summary,\n        uploadedat,\n        processedat,\n        processingstartedat,\n        processingcompletedat\n    FROM dps_dbo.documents\n    WHERE isdeleted = 0\n        AND uploadedat >= DATEADD(DAY, -@Days, GETUTCDATE())\n        AND (@Status IS NULL OR status = @Status)\n        AND (@DocumentTypeName IS NULL OR documenttypename = @DocumentTypeName)\n    ORDER BY uploadedat DESC\nEND",
      "sql_server_specific_syntax": [
        "CREATE PROCEDURE",
        "@Days INT",
        "@Status INT",
        "@DocumentTypeName NVARCHAR(200)",
        "SET NOCOUNT ON",
        "DATEADD(DAY, -@Days, GETUTCDATE())"
      ],
      "parameters": [
        {
          "name": "@Days",
          "type": "INT",
          "default": 7
        },
        {
          "name": "@Status",
          "type": "INT",
          "default": "NULL"
        },
        {
          "name": "@DocumentTypeName",
          "type": "NVARCHAR(200)",
          "default": "NULL"
        }
      ],
      "referenced_tables": [
        "dps_dbo.documents"
      ],
      "context": "Stored procedure creation in EnsureDatabaseAsync method"
    }
  ]
}
